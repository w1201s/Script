--// SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

--// LOAD RAYFIELD
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

--// CONFIGURATION
local CONFIG = {
    Aimbot = {
        Enabled = false,
        Mode = "Normal",
        TeamCheck = false,
        WallCheck = true,
        Smoothness = 0,
        FOV = 150,
        ShowFOV = true,
        FOVColor = Color3.fromRGB(0, 170, 255),
        MaxDistance = 1000,
        TargetPart = "Head",
        UseTargetList = false,
        UseAllyList = false,
        TargetList = {},
        AllyList = {}
    },
    
    ESP = {
        Enabled = false,
        MaxDistance = 1000,
        TextSize = 13,
        TextColor = Color3.fromRGB(255, 50, 50),
        AllyColor = Color3.fromRGB(50, 255, 50),
        BoxColor = Color3.fromRGB(255, 0, 0),
        ShowName = false,
        ShowHealth = false,
        ShowDistance = false,
        ShowWeapon = false,
        TeamCheck = false,
        BoxESP = false,
        TracerESP = false,
        TracerPosition = "Bottom",
        Chams = false,
        UseRGB = false,
        RGBSpeed = 5
    },
    
    Player = {
        InfJump = false,
        WalkSpeed = 16,
        WalkSpeedEnabled = false,
        JumpPower = 50,
        JumpPowerEnabled = false
    }
}

--// VARIABLES
local ESPObjects = {}
local SharedHue = 0  -- Shared RGB hue for both FOV and ESP
local InfJumpConnection = nil
local FOVCircle = Drawing.new("Circle")

--// UTILITY FUNCTIONS
local function GetCharacter(player)
    return player and player.Character
end

local function IsAlive(character)
    if not character then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    return humanoid and humanoid.Health > 0
end

local function IsTeammate(player)
    if not player then return false end
    return player.Team == LocalPlayer.Team
end

local function GetWeaponName(character)
    local tool = character:FindFirstChildOfClass("Tool")
    return tool and tool.Name or "None"
end

local function WorldToScreen(position)
    local screenPos, onScreen = Camera:WorldToViewportPoint(position)
    return Vector2.new(screenPos.X, screenPos.Y), onScreen, screenPos.Z
end

local function IsVisible(targetPart)
    if not CONFIG.Aimbot.WallCheck then return true end
    local origin = Camera.CFrame.Position
    local direction = (targetPart.Position - origin)
    local raycastParams = RaycastParams.new()
    raycastParams.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    local result = Workspace:Raycast(origin, direction, raycastParams)
    if result then
        local hitModel = result.Instance:FindFirstAncestorOfClass("Model")
        return hitModel == targetPart.Parent
    end
    return true
end

local function GetPlayerByName(name)
    for _, p in ipairs(Players:GetPlayers()) do
        if p.Name == name then return p end
    end
    return nil
end

local function IsInTargetList(player)
    for _, targetName in ipairs(CONFIG.Aimbot.TargetList) do
        if targetName == player.Name then return true end
    end
    return false
end

local function IsInAllyList(player)
    for _, allyName in ipairs(CONFIG.Aimbot.AllyList) do
        if allyName == player.Name then return true end
    end
    return false
end

--// ESP SYSTEM
local function CreateESP(player)
    if ESPObjects[player] then return end
    
    local espData = {
        Player = player,
        Drawings = {},
        Highlight = nil
    }
    
    local nameText = Drawing.new("Text")
    nameText.Center = true
    nameText.Outline = true
    nameText.Size = CONFIG.ESP.TextSize
    espData.Drawings.Name = nameText
    
    local healthText = Drawing.new("Text")
    healthText.Center = true
    healthText.Outline = true
    healthText.Size = CONFIG.ESP.TextSize - 2
    espData.Drawings.Health = healthText
    
    local distText = Drawing.new("Text")
    distText.Center = true
    distText.Outline = true
    distText.Size = CONFIG.ESP.TextSize - 2
    espData.Drawings.Distance = distText
    
    local weaponText = Drawing.new("Text")
    weaponText.Center = true
    weaponText.Outline = true
    weaponText.Size = CONFIG.ESP.TextSize - 2
    espData.Drawings.Weapon = weaponText
    
    local box = Drawing.new("Square")
    box.Thickness = 1.5
    box.Filled = false
    box.Visible = false
    espData.Drawings.Box = box
    
    local filledBox = Drawing.new("Square")
    filledBox.Thickness = 1
    filledBox.Filled = true
    filledBox.Transparency = 0.2
    filledBox.Visible = false
    espData.Drawings.FilledBox = filledBox
    
    local tracer = Drawing.new("Line")
    tracer.Thickness = 1
    tracer.Visible = false
    espData.Drawings.Tracer = tracer
    
    espData.Update = function(deltaTime)
        if not CONFIG.ESP.Enabled then
            for _, drawing in pairs(espData.Drawings) do
                drawing.Visible = false
            end
            if espData.Highlight then espData.Highlight.Enabled = false end
            return
        end
        
        local character = GetCharacter(player)
        if not IsAlive(character) then
            for _, drawing in pairs(espData.Drawings) do
                drawing.Visible = false
            end
            if espData.Highlight then espData.Highlight.Enabled = false end
            return
        end
        
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        local head = character:FindFirstChild("Head")
        
        if not humanoid or not rootPart or not head then
            for _, drawing in pairs(espData.Drawings) do
                drawing.Visible = false
            end
            if espData.Highlight then espData.Highlight.Enabled = false end
            return
        end
        
        local distance = (rootPart.Position - Camera.CFrame.Position).Magnitude
        if distance > CONFIG.ESP.MaxDistance then
            for _, drawing in pairs(espData.Drawings) do
                drawing.Visible = false
            end
            if espData.Highlight then espData.Highlight.Enabled = false end
            return
        end
        
        local isTeammate = CONFIG.ESP.TeamCheck and IsTeammate(player)
        local isAlly = CONFIG.Aimbot.UseAllyList and IsInAllyList(player)
        local isTargeted = CONFIG.Aimbot.UseTargetList and IsInTargetList(player)
        local isFriendly = isTeammate or isAlly
        
        -- SHARED RGB COLOR
        local displayColor
        if CONFIG.ESP.UseRGB then
            displayColor = Color3.fromHSV(SharedHue, 1, 1)
        else
            if isTargeted then
                displayColor = Color3.fromRGB(255, 0, 255)
            else
                displayColor = isFriendly and CONFIG.ESP.AllyColor or CONFIG.ESP.TextColor
            end
        end
        
        espData.Drawings.Name.Color = displayColor
        espData.Drawings.Box.Color = displayColor
        espData.Drawings.FilledBox.Color = displayColor
        espData.Drawings.Tracer.Color = displayColor
        
        local headPos, headOnScreen = WorldToScreen(head.Position + Vector3.new(0, 0.5, 0))
        local rootPos, rootOnScreen = WorldToScreen(rootPart.Position - Vector3.new(0, 3, 0))
        
        if not headOnScreen and not rootOnScreen then
            for _, drawing in pairs(espData.Drawings) do
                drawing.Visible = false
            end
            if espData.Highlight then espData.Highlight.Enabled = false end
            return
        end
        
        local tracerStart = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
        if CONFIG.ESP.TracerPosition == "Top" then
            tracerStart = Vector2.new(Camera.ViewportSize.X / 2, 0)
        elseif CONFIG.ESP.TracerPosition == "Left" then
            tracerStart = Vector2.new(0, Camera.ViewportSize.Y / 2)
        elseif CONFIG.ESP.TracerPosition == "Right" then
            tracerStart = Vector2.new(Camera.ViewportSize.X, Camera.ViewportSize.Y / 2)
        end
        
        local boxHeight = math.abs(headPos.Y - rootPos.Y)
        local boxWidth = boxHeight * 0.6
        local boxPos = Vector2.new(headPos.X - boxWidth / 2, headPos.Y)
        
        if CONFIG.ESP.ShowName then
            local tag = ""
            if isTargeted then
                tag = " [TARGET]"
            elseif isAlly then
                tag = " [ALLY]"
            elseif isTeammate then
                tag = " [TEAM]"
            else
                tag = " [ENEMY]"
            end
            espData.Drawings.Name.Text = player.Name .. tag
            espData.Drawings.Name.Position = Vector2.new(headPos.X, headPos.Y - 20)
            espData.Drawings.Name.Visible = true
        else
            espData.Drawings.Name.Visible = false
        end
        
        if CONFIG.ESP.ShowHealth then
            local hpPercent = math.floor((humanoid.Health / humanoid.MaxHealth) * 100)
            espData.Drawings.Health.Text = hpPercent .. " HP"
            espData.Drawings.Health.Color = Color3.fromRGB(255 - (hpPercent * 2.55), hpPercent * 2.55, 0)
            espData.Drawings.Health.Position = Vector2.new(headPos.X, headPos.Y - 35)
            espData.Drawings.Health.Visible = true
        else
            espData.Drawings.Health.Visible = false
        end
        
        if CONFIG.ESP.ShowDistance then
            espData.Drawings.Distance.Text = math.floor(distance) .. "m"
            espData.Drawings.Distance.Position = Vector2.new(headPos.X, rootPos.Y + 5)
            espData.Drawings.Distance.Visible = true
        else
            espData.Drawings.Distance.Visible = false
        end
        
        if CONFIG.ESP.ShowWeapon then
            espData.Drawings.Weapon.Text = GetWeaponName(character)
            espData.Drawings.Weapon.Position = Vector2.new(headPos.X, rootPos.Y + 20)
            espData.Drawings.Weapon.Visible = true
        else
            espData.Drawings.Weapon.Visible = false
        end
        
        if CONFIG.ESP.BoxESP then
            espData.Drawings.Box.Size = Vector2.new(boxWidth, boxHeight)
            espData.Drawings.Box.Position = boxPos
            espData.Drawings.Box.Visible = true
            
            espData.Drawings.FilledBox.Size = Vector2.new(boxWidth, boxHeight)
            espData.Drawings.FilledBox.Position = boxPos
            espData.Drawings.FilledBox.Visible = CONFIG.ESP.Chams
        else
            espData.Drawings.Box.Visible = false
            espData.Drawings.FilledBox.Visible = false
        end
        
        if CONFIG.ESP.TracerESP then
            espData.Drawings.Tracer.From = tracerStart
            espData.Drawings.Tracer.To = Vector2.new(rootPos.X, rootPos.Y)
            espData.Drawings.Tracer.Visible = true
        else
            espData.Drawings.Tracer.Visible = false
        end
        
        if CONFIG.ESP.Chams then
            if not espData.Highlight or espData.Highlight.Parent ~= character then
                if espData.Highlight then espData.Highlight:Destroy() end
                espData.Highlight = Instance.new("Highlight")
                espData.Highlight.FillColor = displayColor
                espData.Highlight.OutlineColor = Color3.new(1, 1, 1)
                espData.Highlight.FillTransparency = 0.5
                espData.Highlight.OutlineTransparency = 0
                espData.Highlight.Parent = character
            end
            espData.Highlight.Enabled = true
            espData.Highlight.FillColor = displayColor
        elseif espData.Highlight then
            espData.Highlight.Enabled = false
        end
    end
    
    espData.Cleanup = function()
        for _, drawing in pairs(espData.Drawings) do
            drawing:Remove()
        end
        if espData.Highlight then espData.Highlight:Destroy() end
    end
    
    ESPObjects[player] = espData
end

local function RemoveESP(player)
    local espData = ESPObjects[player]
    if espData then
        espData.Cleanup()
        ESPObjects[player] = nil
    end
end

--// AIMBOT LOGIC
local function GetTarget()
    if CONFIG.Aimbot.Mode == "Target" and CONFIG.Aimbot.UseTargetList then
        for _, targetName in ipairs(CONFIG.Aimbot.TargetList) do
            local player = GetPlayerByName(targetName)
            if player and player ~= LocalPlayer then
                if IsAlive(GetCharacter(player)) then
                    if CONFIG.Aimbot.TeamCheck and IsTeammate(player) then continue end
                    if CONFIG.Aimbot.UseAllyList and IsInAllyList(player) then continue end
                    
                    local character = GetCharacter(player)
                    local targetPart = character:FindFirstChild(CONFIG.Aimbot.TargetPart)
                    if targetPart then
                        if CONFIG.Aimbot.WallCheck and not IsVisible(targetPart) then continue end
                        
                        local distance = (targetPart.Position - Camera.CFrame.Position).Magnitude
                        if distance <= CONFIG.Aimbot.MaxDistance then
                            return player
                        end
                    end
                end
            end
        end
        return nil
    end
    
    local closestPlayer = nil
    local shortestDistance = CONFIG.Aimbot.FOV
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player == LocalPlayer then continue end
        if not IsAlive(GetCharacter(player)) then continue end
        if CONFIG.Aimbot.TeamCheck and IsTeammate(player) then continue end
        if CONFIG.Aimbot.UseAllyList and IsInAllyList(player) then continue end
        if CONFIG.Aimbot.UseTargetList and not IsInTargetList(player) then continue end
        
        local character = GetCharacter(player)
        local targetPart = character:FindFirstChild(CONFIG.Aimbot.TargetPart)
        if not targetPart then continue end
        if CONFIG.Aimbot.WallCheck and not IsVisible(targetPart) then continue end
        
        local screenPos, onScreen, depth = WorldToScreen(targetPart.Position)
        if not onScreen or depth > CONFIG.Aimbot.MaxDistance then continue end
        
        local distance = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
        if distance < shortestDistance then
            shortestDistance = distance
            closestPlayer = player
        end
    end
    return closestPlayer
end

--// RAYFIELD UI
local Window = Rayfield:CreateWindow({
    Name = "Venus x",
    LoadingTitle = "Venus x Loading",
    LoadingSubtitle = "by w1201s",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "VenusX",
        FileName = "Config"
    },
    KeySystem = false
})

local AimbotTab = Window:CreateTab("Aimbot", 4483362458)
local ESPTab = Window:CreateTab("ESP", 4483362458)
local PlayersTab = Window:CreateTab("Players", 4483362458)
local ColorsTab = Window:CreateTab("Colors", 4483362458)

--// AIMBOT TAB
AimbotTab:CreateToggle({
    Name = "Enable Aimbot",
    CurrentValue = CONFIG.Aimbot.Enabled,
    Flag = "AimbotEnabled",
    Callback = function(v) CONFIG.Aimbot.Enabled = v end
})

AimbotTab:CreateDropdown({
    Name = "Mode",
    Options = {"Normal", "Target"},
    CurrentOption = CONFIG.Aimbot.Mode,
    Flag = "AimbotMode",
    Callback = function(v) CONFIG.Aimbot.Mode = v end
})

AimbotTab:CreateToggle({
    Name = "Team Check",
    CurrentValue = CONFIG.Aimbot.TeamCheck,
    Flag = "TeamCheck",
    Callback = function(v) CONFIG.Aimbot.TeamCheck = v end
})

AimbotTab:CreateToggle({
    Name = "Wall Check",
    CurrentValue = CONFIG.Aimbot.WallCheck,
    Flag = "WallCheck",
    Callback = function(v) CONFIG.Aimbot.WallCheck = v end
})

AimbotTab:CreateToggle({
    Name = "Show FOV",
    CurrentValue = CONFIG.Aimbot.ShowFOV,
    Flag = "ShowFOV",
    Callback = function(v) CONFIG.Aimbot.ShowFOV = v end
})

AimbotTab:CreateSlider({
    Name = "FOV Size",
    Range = {50, 400},
    Increment = 10,
    Suffix = "px",
    CurrentValue = CONFIG.Aimbot.FOV,
    Flag = "FOVSize",
    Callback = function(v) CONFIG.Aimbot.FOV = v end
})

AimbotTab:CreateSlider({
    Name = "Max Distance",
    Range = {100, 5000},
    Increment = 50,
    Suffix = "m",
    CurrentValue = CONFIG.Aimbot.MaxDistance,
    Flag = "MaxDistance",
    Callback = function(v) CONFIG.Aimbot.MaxDistance = v end
})

AimbotTab:CreateDropdown({
    Name = "Target Part",
    Options = {"Head", "HumanoidRootPart"},
    CurrentOption = CONFIG.Aimbot.TargetPart,
    Flag = "TargetPart",
    Callback = function(v) CONFIG.Aimbot.TargetPart = v end
})

AimbotTab:CreateSlider({
    Name = "Smoothness",
    Range = {0, 10},
    Increment = 0.5,
    Suffix = "",
    CurrentValue = CONFIG.Aimbot.Smoothness,
    Flag = "Smoothness",
    Callback = function(v) CONFIG.Aimbot.Smoothness = v end
})

--// ESP TAB
ESPTab:CreateToggle({
    Name = "Enable ESP",
    CurrentValue = CONFIG.ESP.Enabled,
    Flag = "ESPEnabled",
    Callback = function(v) CONFIG.ESP.Enabled = v end
})

ESPTab:CreateToggle({
    Name = "Team Check",
    CurrentValue = CONFIG.ESP.TeamCheck,
    Flag = "ESPTeamCheck",
    Callback = function(v) CONFIG.ESP.TeamCheck = v end
})

ESPTab:CreateToggle({
    Name = "Box ESP",
    CurrentValue = CONFIG.ESP.BoxESP,
    Flag = "BoxESP",
    Callback = function(v) CONFIG.ESP.BoxESP = v end
})

ESPTab:CreateToggle({
    Name = "Tracer ESP",
    CurrentValue = CONFIG.ESP.TracerESP,
    Flag = "TracerESP",
    Callback = function(v) CONFIG.ESP.TracerESP = v end
})

ESPTab:CreateDropdown({
    Name = "Tracer Position",
    Options = {"Bottom", "Top", "Left", "Right"},
    CurrentOption = CONFIG.ESP.TracerPosition,
    Flag = "TracerPosition",
    Callback = function(v) CONFIG.ESP.TracerPosition = v end
})

ESPTab:CreateToggle({
    Name = "Chams",
    CurrentValue = CONFIG.ESP.Chams,
    Flag = "Chams",
    Callback = function(v) CONFIG.ESP.Chams = v end
})

ESPTab:CreateToggle({
    Name = "Show Names",
    CurrentValue = CONFIG.ESP.ShowName,
    Flag = "ShowNames",
    Callback = function(v) CONFIG.ESP.ShowName = v end
})

ESPTab:CreateToggle({
    Name = "Show Health",
    CurrentValue = CONFIG.ESP.ShowHealth,
    Flag = "ShowHealth",
    Callback = function(v) CONFIG.ESP.ShowHealth = v end
})

ESPTab:CreateToggle({
    Name = "Show Distance",
    CurrentValue = CONFIG.ESP.ShowDistance,
    Flag = "ShowDistance",
    Callback = function(v) CONFIG.ESP.ShowDistance = v end
})

ESPTab:CreateToggle({
    Name = "Show Weapon",
    CurrentValue = CONFIG.ESP.ShowWeapon,
    Flag = "ShowWeapon",
    Callback = function(v) CONFIG.ESP.ShowWeapon = v end
})

ESPTab:CreateSlider({
    Name = "Max Distance",
    Range = {100, 5000},
    Increment = 100,
    Suffix = "m",
    CurrentValue = CONFIG.ESP.MaxDistance,
    Flag = "ESPMaxDistance",
    Callback = function(v) CONFIG.ESP.MaxDistance = v end
})

--// PLAYERS TAB
PlayersTab:CreateSection("Movement")

PlayersTab:CreateToggle({
    Name = "Infinite Jump",
    CurrentValue = CONFIG.Player.InfJump,
    Flag = "InfJump",
    Callback = function(v)
        CONFIG.Player.InfJump = v
        if v then
            InfJumpConnection = UserInputService.JumpRequest:Connect(function()
                local char = GetCharacter(LocalPlayer)
                if char then
                    local humanoid = char:FindFirstChildOfClass("Humanoid")
                    if humanoid then
                        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                    end
                end
            end)
        else
            if InfJumpConnection then
                InfJumpConnection:Disconnect()
                InfJumpConnection = nil
            end
        end
    end
})

PlayersTab:CreateToggle({
    Name = "Enable WalkSpeed",
    CurrentValue = CONFIG.Player.WalkSpeedEnabled,
    Flag = "WalkSpeedToggle",
    Callback = function(v)
        CONFIG.Player.WalkSpeedEnabled = v
        local char = GetCharacter(LocalPlayer)
        if char then
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = v and CONFIG.Player.WalkSpeed or 16
            end
        end
    end
})

PlayersTab:CreateSlider({
    Name = "WalkSpeed",
    Range = {16, 200},
    Increment = 1,
    Suffix = "",
    CurrentValue = CONFIG.Player.WalkSpeed,
    Flag = "WalkSpeed",
    Callback = function(v)
        CONFIG.Player.WalkSpeed = v
        if CONFIG.Player.WalkSpeedEnabled then
            local char = GetCharacter(LocalPlayer)
            if char then
                local humanoid = char:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid.WalkSpeed = v
                end
            end
        end
    end
})

PlayersTab:CreateToggle({
    Name = "Enable JumpPower",
    CurrentValue = CONFIG.Player.JumpPowerEnabled,
    Flag = "JumpPowerToggle",
    Callback = function(v)
        CONFIG.Player.JumpPowerEnabled = v
        local char = GetCharacter(LocalPlayer)
        if char then
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.JumpPower = v and CONFIG.Player.JumpPower or 50
            end
        end
    end
})

PlayersTab:CreateSlider({
    Name = "JumpPower",
    Range = {50, 200},
    Increment = 1,
    Suffix = "",
    CurrentValue = CONFIG.Player.JumpPower,
    Flag = "JumpPower",
    Callback = function(v)
        CONFIG.Player.JumpPower = v
        if CONFIG.Player.JumpPowerEnabled then
            local char = GetCharacter(LocalPlayer)
            if char then
                local humanoid = char:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid.JumpPower = v
                end
            end
        end
    end
})

PlayersTab:CreateSection("Target & Ally")

PlayersTab:CreateToggle({
    Name = "Use Target List",
    CurrentValue = CONFIG.Aimbot.UseTargetList,
    Flag = "UseTargetList",
    Callback = function(v) CONFIG.Aimbot.UseTargetList = v end
})

local targetDropdown = PlayersTab:CreateDropdown({
    Name = "Target Players",
    Options = {},
    CurrentOption = {},
    MultipleOptions = true,
    Flag = "TargetDropdown",
    Callback = function(v)
        CONFIG.Aimbot.TargetList = v
    end
})

PlayersTab:CreateButton({
    Name = "ðŸ”„ Refresh Target List",
    Callback = function()
        local names = {}
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= LocalPlayer then table.insert(names, p.Name) end
        end
        targetDropdown:Refresh(names)
        Rayfield:Notify({
            Title = "Target List",
            Content = #names .. " players",
            Duration = 2
        })
    end
})

PlayersTab:CreateToggle({
    Name = "Use Ally List",
    CurrentValue = CONFIG.Aimbot.UseAllyList,
    Flag = "UseAllyList",
    Callback = function(v) CONFIG.Aimbot.UseAllyList = v end
})

local allyDropdown = PlayersTab:CreateDropdown({
    Name = "Ally Players",
    Options = {},
    CurrentOption = {},
    MultipleOptions = true,
    Flag = "AllyDropdown",
    Callback = function(v)
        CONFIG.Aimbot.AllyList = v
    end
})

PlayersTab:CreateButton({
    Name = "ðŸ”„ Refresh Ally List",
    Callback = function()
        local names = {}
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= LocalPlayer then table.insert(names, p.Name) end
        end
        allyDropdown:Refresh(names)
        Rayfield:Notify({
            Title = "Ally List",
            Content = #names .. " players",
            Duration = 2
        })
    end
})

--// COLORS TAB - SYNCHRONIZED RGB
ColorsTab:CreateSection("RGB Settings")

ColorsTab:CreateToggle({
    Name = "Enable RGB Mode",
    Desc = "Sync FOV + ESP colors",
    CurrentValue = CONFIG.ESP.UseRGB,
    Flag = "SyncRGB",
    Callback = function(v)
        CONFIG.ESP.UseRGB = v
    end
})

ColorsTab:CreateSlider({
    Name = "RGB Speed",
    Desc = "Shared speed for FOV and ESP",
    Range = {1, 20},
    Increment = 0.5,
    Suffix = "",
    CurrentValue = CONFIG.ESP.RGBSpeed,
    Flag = "RGBSpeed",
    Callback = function(v) CONFIG.ESP.RGBSpeed = v end
})

ColorsTab:CreateSection("Static Colors")

ColorsTab:CreateColorPicker({
    Name = "Enemy Color",
    Color = CONFIG.ESP.TextColor,
    Flag = "EnemyColor",
    Callback = function(c) CONFIG.ESP.TextColor = c end
})

ColorsTab:CreateColorPicker({
    Name = "Ally Color",
    Color = CONFIG.ESP.AllyColor,
    Flag = "AllyColor",
    Callback = function(c) CONFIG.ESP.AllyColor = c end
})

ColorsTab:CreateColorPicker({
    Name = "Box Color",
    Color = CONFIG.ESP.BoxColor,
    Flag = "BoxColor",
    Callback = function(c) CONFIG.ESP.BoxColor = c end
})

ColorsTab:CreateColorPicker({
    Name = "FOV Circle Color",
    Color = CONFIG.Aimbot.FOVColor,
    Flag = "FOVColor",
    Callback = function(c) CONFIG.Aimbot.FOVColor = c end
})

--// MAIN LOOP
FOVCircle.Thickness = 1.5
FOVCircle.Filled = false
FOVCircle.NumSides = 64

RunService.RenderStepped:Connect(function()
    local deltaTime = task.wait()
    
    -- SHARED RGB - Both FOV and ESP use same hue
    if CONFIG.ESP.UseRGB then
        SharedHue = (SharedHue + deltaTime * CONFIG.ESP.RGBSpeed * 0.1) % 1
        local color = Color3.fromHSV(SharedHue, 1, 1)
        FOVCircle.Color = color
    else
        FOVCircle.Color = CONFIG.Aimbot.FOVColor
    end
    
    -- FOV Circle (Normal mode only)
    local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    FOVCircle.Position = screenCenter
    FOVCircle.Radius = CONFIG.Aimbot.FOV
    FOVCircle.Visible = CONFIG.Aimbot.Enabled and CONFIG.Aimbot.ShowFOV and CONFIG.Aimbot.Mode == "Normal"
    
    -- ESP
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            if not ESPObjects[player] then CreateESP(player) end
            ESPObjects[player].Update(deltaTime)
        end
    end
    
    -- Cleanup
    for player, _ in pairs(ESPObjects) do
        if not player or not player.Parent then RemoveESP(player) end
    end
    
    -- AIMBOT
    if CONFIG.Aimbot.Enabled then
        local target = GetTarget()
        if target then
            local character = GetCharacter(target)
            local targetPart = character:FindFirstChild(CONFIG.Aimbot.TargetPart)
            if targetPart then
                if CONFIG.Aimbot.Mode == "Target" then
                    -- HARD LOCK: Instant
                    Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPart.Position)
                else
                    -- Normal mode
                    if CONFIG.Aimbot.Smoothness <= 0 then
                        Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetPart.Position)
                    else
                        local smoothFactor = math.clamp(1 - (CONFIG.Aimbot.Smoothness / 10), 0.01, 1)
                        Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, targetPart.Position), smoothFactor)
                    end
                end
            end
        end
    end
    
    -- WalkSpeed & JumpPower auto-apply
    if CONFIG.Player.WalkSpeedEnabled or CONFIG.Player.JumpPowerEnabled then
        local char = GetCharacter(LocalPlayer)
        if char then
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if humanoid then
                if CONFIG.Player.WalkSpeedEnabled and humanoid.WalkSpeed ~= CONFIG.Player.WalkSpeed then
                    humanoid.WalkSpeed = CONFIG.Player.WalkSpeed
                end
                if CONFIG.Player.JumpPowerEnabled and humanoid.JumpPower ~= CONFIG.Player.JumpPower then
                    humanoid.JumpPower = CONFIG.Player.JumpPower
                end
            end
        end
    end
end)

--// INIT
task.spawn(function()
    if not LocalPlayer.Character then LocalPlayer.CharacterAdded:Wait() end
    task.wait(1)
    
    local names = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then table.insert(names, p.Name) end
    end
    targetDropdown:Refresh(names)
    allyDropdown:Refresh(names)
    
    print("âœ… Venus x Rayfield Loaded!")
end)
